<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>BootLearn-MBA | Sign Up</title>
<style>
  /* Minimal styling for demo */
  .step { display: none; }
  .step.active { display: block; }
  .error { color: red; display: none; }
</style>
</head>
<body>
<form id="signupForm" novalidate>
  <div class="step active">
    <label>Name*: <input type="text" name="name" required></label>
    <div class="error">Please enter your name</div>
    <br />
    <label>Email*: <input type="email" name="email" required></label>
    <div class="error">Please enter valid email</div>
    <br />
    <label>Phone*: <input type="tel" name="phone" pattern="[0-9]{10}" required></label>
    <div class="error">Please enter valid 10-digit phone</div>
  </div>
  
  <div class="step">
    <label>Category*: <select name="category" required>
      <option value="">Select</option>
      <option>General</option>
      <option>EWS</option>
      <option>OBC</option>
      <option>SC</option>
      <option>ST</option>
      <option>PWD</option>
    </select></label>
    <div class="error">Please select category</div>
    <br />
    <label>Gender*: <select name="gender" required>
      <option value="">Select</option>
      <option>Male</option>
      <option>Female</option>
      <option>Other</option>
      <option>Prefer not to say</option>
    </select></label>
    <div class="error">Please select gender</div>
    <br />
    <label>10th %*: <input type="text" name="tenth" required></label>
    <div class="error">Please enter valid %</div>
    <br />
    <label>12th %*: <input type="text" name="twelfth" required></label>
    <div class="error">Please enter valid %</div>
  </div>
  
  <div class="step">
    <label>Graduation Degree*: <input type="text" name="graduation" required></label>
    <div class="error">Please enter degree</div>
    <br />
    <label>Graduation %*: <input type="text" name="gradPercent" required></label>
    <div class="error">Please enter valid %</div>
    <br />
    <label>Work Experience (months): <input type="number" name="workEx" min="0" max="600"></label>
    <br />
    <label>Password*: <input type="password" name="password" minlength="6" required></label>
    <div class="error">Password must be at least 6 chars</div>
  </div>
  
  <button type="button" id="prevBtn" style="display:none;">Back</button>
  <button type="button" id="nextBtn">Next</button>
</form>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const SUPABASE_URL = 'https://warrbsimkytwguktqnyo.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndhcnJic2lta3l0d2d1a3RxbnlvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU5MzIzMTQsImV4cCI6MjA3MTUwODMxNH0._9zpeZRiyysLR2Ga30aGAlt0_Z0z8v7cmkrhUBRLLcQ';
const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

const form = document.getElementById('signupForm');
const steps = form.querySelectorAll('.step');
const nextBtn = document.getElementById('nextBtn');
const prevBtn = document.getElementById('prevBtn');
let currentStep = 0;

function showStep(n) {
  steps.forEach((step, i) => {
    step.classList.toggle('active', i === n);
  });
  prevBtn.style.display = n === 0 ? 'none' : 'inline-block';
  if (n === steps.length - 1) {
    nextBtn.textContent = 'Sign Up';
  } else {
    nextBtn.textContent = 'Next';
  }
}

function validateStep(n) {
  const inputs = steps[n].querySelectorAll('input, select');
  let valid = true;
  inputs.forEach(input => {
    const errorEl = input.nextElementSibling;
    if (!input.checkValidity()) {
      valid = false;
      if (errorEl) errorEl.style.display = 'block';
    } else {
      if (errorEl) errorEl.style.display = 'none';
    }
  });
  return valid;
}

nextBtn.addEventListener('click', async () => {
  if (!validateStep(currentStep)) return;

  if (currentStep < steps.length -1) {
    currentStep++;
    showStep(currentStep);
  } else {
    nextBtn.disabled = true;
    nextBtn.textContent = 'Signing up...';
    // Collect all form data at once for signup
    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());

    try {
      const { data: userData, error } = await supabase.auth.signUp({
        email: data.email.trim(),
        password: data.password,
        options: {
          data: {
            name: data.name.trim(),
            phone: data.phone.trim(),
            category: data.category,
            gender: data.gender,
            tenth: data.tenth.trim(),
            twelfth: data.twelfth.trim(),
            graduation: data.graduation.trim(),
            gradPercent: data.gradPercent.trim(),
            workEx: data.workEx.trim(),
          }
        }
      });

      if (error) {
        alert('Signup error: ' + error.message);
      } else {
        alert('Signup successful! Please check your email to confirm.');
        form.reset();
        currentStep = 0;
        showStep(currentStep);
        // Redirect or do whatever next
        window.location.href = 'login.html';
      }
    } catch (err) {
      alert('Unexpected error: ' + err.message);
    } finally {
      nextBtn.disabled = false;
      nextBtn.textContent = 'Sign Up';
    }
  }
});

prevBtn.addEventListener('click', () => {
  if (currentStep > 0) {
    currentStep--;
    showStep(currentStep);
  }
});

// Initialize form UI
showStep(currentStep);
</script>
</body>
</html>
